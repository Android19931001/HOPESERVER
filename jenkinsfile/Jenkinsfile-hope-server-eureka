#!/usr/bin/env groovy

node {
    stage('checkout') {
        checkout scm
    }

//    stage('check java') {
//        sh "java -version"
//    }

    stage('clean') {
        sh "chmod +x mvnw"
        sh "./mvnw clean"
    }


    /*stage('install tools') {
        sh "./mvnw com.github.eirslett:frontend-maven-plugin:install-node-and-yarn -DnodeVersion=v8.9.4 -DyarnVersion=v1.3.2"
    }

    stage('yarn install') {
        sh "./mvnw com.github.eirslett:frontend-maven-plugin:yarn"
    }*/

    stage('packaging') {
        sh "./mvnw -pl hope-server-eureka -am package -Pprod -DskipTest"
        archiveArtifacts artifacts: '**/target/*.jar', fingerprint: true
    }

    def dockerImage
    stage('build docker') {
        sh "cp -R hope-server-eureka/target/"
        sh "cp hope-server-eureka/target/hope-*.jar"
    }
}